(function(c){c.fn.popsuggest=function(g){var h=c.extend({placement:"right",dataUrl:"data.html",chainLength:2,rows:8,separator:",",html:false,addData:{}},g);var f="ok",i=-1,e=0;dataUrl=h.dataUrl,separator=h.separator,allowHtml=h.html,addData=h.addData,rows=h.rows;this.popover({placement:h.placement,trigger:"manual",html:true});this.click(function(j){if(this.value.length>=h.chainLength){d(this,this.value)}}).keyup(function(k){var j="";if(k.keyCode==40||k.keyCode==38||k.keyCode==13){switch(k.keyCode){case 40:i+=1;break;case 38:i-=1;break}f=a(k.keyCode,i,this);if(f=="over"){i=-1}}else{j=this.value;if(j.length>=h.chainLength){i=-1;d(this,j)}else{c(this).popover("hide");c(".popover").remove()}}});c("body").on("click",function(j){c('[data-toggle="popover"]').each(function(){if(!c(this).is(j.target)&&c(this).has(j.target).length===0&&c(".popover").has(j.target).length===0){c(this).popover("hide")}})});return this};function d(f,e){c("body").css("cursor","wait");c(f).css("cursor","wait");c.ajax({method:"post",url:dataUrl,data:c.extend({chain:e},addData)}).done(function(n){c("body").css("cursor","default");c(f).css("cursor","default");var m=n.split(separator),j=m.length,k=document.createElement("div"),g=rows,h;for(h=0;h<j;h++){if(h%g==0){if(h==g){k.appendChild(o)}var o=document.createElement("div");o.style.display="inline-block";o.style.marginTop="10px";o.style.marginLeft="10px";o.style.marginRight="10px";o.style.cursor="pointer";o.style.verticalAlign="top"}var l=document.createElement("p");l.className="result";if(allowHtml&&!m[h].match(/<\/?p>/)){l.innerHTML=m[h]}else{l.appendChild(document.createTextNode(m[h]))}o.appendChild(l);if(h%g==0&&h>0){k.appendChild(o)}}if(h<g){k.appendChild(o)}c(f).attr("data-content",k.outerHTML);c(f).popover("show");setTimeout(function(){b(f)},200)}).fail(function(g){console.log(g);alert("Oups ! search fail.")})}function b(h){var g=document.querySelectorAll(".result"),f=g.length;for(var e=0;e<f;e++){g[e].addEventListener("mouseover",function(){this.style.color="#666"},false);g[e].addEventListener("mouseout",function(){this.style.color="black"},false);g[e].addEventListener("click",function(i){h.value=i.target.innerHTML;c(h).popover("hide");c(".popover").remove();c(h).trigger("popSelect")},false)}}function a(j,k,h){var g=document.getElementsByClassName("result"),f=g.length;for(var e=0;e<f;e++){g[e].style.color="black"}if(j==40&&k<f){g[k].style.color="#666";return"ok"}else{if(j==38&&k>=0){g[k].style.color="#666";return"ok"}else{if(j==13&&k>=0&&k<f){h.value=g[k].innerHTML;c(h).popover("hide");c(".popover").remove();c(h).trigger("popSelect");return"ok"}else{return"over"}}}}}(jQuery));